<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width"
    />
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://rawgit.com/mayognaise/aframe-gif-shader/master/dist/aframe-gif-shader.min.js"></script>
    <script>
      AFRAME.registerComponent("animate-png", {
        init: function() {
          // load the .pngs
          let loader = new THREE.TextureLoader();
          this.pngArray = [];

          let imageInd = 0;
          const frameNum = 202;
          const imageHeader = "lly";
          while (imageInd < frameNum) {
            
            temp = ('000'+imageInd).slice(-3);
            
            url = "/assets/" + imageHeader + "_" + temp + ".png";
            this.pngArray.push(
              loader.load(
                (src = url
                )
              )
            );
            
            imageInd++;
          }

          this.el.addEventListener("loaded", e => {
            let mesh = this.el.getObject3D("mesh");
            this.material = mesh.material;
            this.material.alphaTest = 0.5;

            var i = 0;
            this.id = setInterval(e => {
              if (i >= this.pngArray.length) i = 0;
              this.material.map = this.pngArray[i++];
              this.material.needsUpdate = true;
            }, 45);
          });
        },
        remove: function() {
          clearInterval(this.id);
          // free the memory
          for (let i = 0; i < this.pngArray.length; i++) {
            this.pngArray[i].dispose();
          }
        }
      });
    </script>
  </head>
  <body>
    <a-scene background="color: white">
      <!-- assets -->
      <a-assets>
        <img src="/assets/lly_bg.png" id="bg">
      </a-assets>

      <a-entity light="type: ambient; color: #f2dcb6; castShadow: true" position="0 0 -3">

        <a-plane
          position="0 1.5 -3"
          material="src:#bg; opacity:1; transparent:true"
          height=7
          width=5
        >
        </a-plane>
        <a-plane
          position="0 1 -2"
          height=7
          width=5
          animate-png

        ></a-plane>
      </a-entity>

    </a-scene>
  </body>
</html>

