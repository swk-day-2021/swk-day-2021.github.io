<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width"
    />
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://rawgit.com/mayognaise/aframe-gif-shader/master/dist/aframe-gif-shader.min.js"></script>
    <script>
      AFRAME.registerComponent("animate-png", {
        init: function() {
          // load the .pngs
          let loader = new THREE.TextureLoader();
          this.pngArray = [];
          // const testFolder = "./assets/";
          // const fs = require("fs");
          // fs.readdirSync(testFolder).forEach(file => {
          //   console.log(file)
          // });

          let imageInd = 0;
          const frameNum = 4;
          const imageHeader = "lly";
          const width = 3;
          while (imageInd < frameNum) {
            
            temp = ('000'+frameNum).slice(-3);

            this.pngArray.push(
              loader.load(
                (src =
                  "./assets/${imageHeader}_${temp}.png"
                )
              )
            );
            imageInd++;
          }

          this.pngArray.push(
            loader.load(
              "https://upload.wikimedia.org/wikipedia/commons/4/47/PNG_transparency_demonstration_1.png"
            )
          );
          this.pngArray.push(
            loader.load(
              "https://lh3.googleusercontent.com/proxy/1ms8YLowltDpXB7kiMgNMAEMJoesudHsmRbczpnp_CV7RZALTNZyqq41jcfVlX3uUnGpzhK6AWIJDyne1ZE5tSN3gC57Ijyt7-Q2"
            )
          );
          this.pngArray.push(
            loader.load(
              "https://upload.wikimedia.org/wikipedia/commons/4/43/The_Earth_seen_from_Apollo_17_with_transparent_background.png"
            )
          );

          this.el.addEventListener("loaded", e => {
            let mesh = this.el.getObject3D("mesh");
            this.material = mesh.material;
            this.material.alphaTest = 0.5;

            var i = 0;
            this.id = setInterval(e => {
              if (i >= this.pngArray.length) i = 0;
              this.material.map = this.pngArray[i++];
              this.material.needsUpdate = true;
            }, 500);
          });
        },
        remove: function() {
          clearInterval(this.id);
          // free the memory
          for (let i = 0; i < this.pngArray.length; i++) {
            this.pngArray[i].dispose();
          }
        }
      });
    </script>
  </head>
  <body>
    <a-scene>
      <!-- assets -->
      <a-assets>
        <!--         <img
          id="banana"
          src="https://mayognaise.github.io/aframe-gif-shader/basic/banana.gif"
        /> -->
      </a-assets>

      <a-entity position="0 0 -5">
        <!-- banana -->
        <a-plane
          position="0 1 -2"
          material="src:https://upload.wikimedia.org/wikipedia/commons/4/43/The_Earth_seen_from_Apollo_17_with_transparent_background.png;
                                  opacity:1; transparent:true"
        >
        </a-plane>
        <a-plane
          position="-1 0.5 2"
          animate-png
          opacity:1;
          transparent:true
        ></a-plane>
      </a-entity>

      <!-- sky -->
      <a-sky color="pink"></a-sky>
    </a-scene>
  </body>
</html>
